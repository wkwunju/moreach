# Instagram å½±å“è€…å‘ç° - å®Œæ•´è®¾è®¡æ–‡æ¡£

> **AI é©±åŠ¨çš„ Instagram å½±å“è€…å‘ç°ç³»ç»Ÿ**
> 
> é€šè¿‡ Google æœç´¢å’Œ Instagram æŠ“å–ï¼Œè‡ªåŠ¨å‘ç°ã€åˆ†æå’Œæ¨èç›¸å…³å½±å“è€…

---

## ğŸ“– ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒæµç¨‹](#æ ¸å¿ƒæµç¨‹)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
5. [æ•°æ®åŒæ­¥ç­–ç•¥](#æ•°æ®åŒæ­¥ç­–ç•¥)
6. [å‰ç«¯è®¾è®¡](#å‰ç«¯è®¾è®¡)
7. [åç«¯æœåŠ¡](#åç«¯æœåŠ¡)
8. [API å‚è€ƒ](#api-å‚è€ƒ)
9. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
10. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
11. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ç³»ç»Ÿæ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½

**Instagram Influencer Discovery** æ˜¯ä¸€ä¸ªæ™ºèƒ½åŒ–çš„å½±å“è€…å‘ç°ç³»ç»Ÿï¼Œé€šè¿‡ AI æŠ€æœ¯è‡ªåŠ¨ä» Instagram å‘ç°å’Œåˆ†æç¬¦åˆå“ç‰Œéœ€æ±‚çš„å½±å“è€…ã€‚

#### ä¸»è¦ç‰¹æ€§

1. **æ™ºèƒ½æ„å›¾åˆ†æ**
   - LLM è§£æç”¨æˆ·éœ€æ±‚
   - æå–è¡Œä¸šã€åœ°ç‚¹ã€çº¦æŸæ¡ä»¶
   - ç”Ÿæˆä¼˜åŒ–çš„æœç´¢ç­–ç•¥

2. **Google Dork æœç´¢**
   - AI ç”Ÿæˆç²¾å‡†æœç´¢æŸ¥è¯¢
   - è‡ªåŠ¨æŸ¥æ‰¾ Instagram profiles
   - è¿”å›å€™é€‰äººåˆ—è¡¨

3. **Instagram æ•°æ®æŠ“å–**
   - ä½¿ç”¨ Apify æŠ“å– profile æ•°æ®
   - è·å–æœ€è¿‘çš„å¸–å­å’Œäº’åŠ¨æ•°æ®
   - æå–è”ç³»ä¿¡æ¯

4. **AI æ·±åº¦åˆ†æ**
   - Profile Summaryï¼ˆåšä¸»æ¦‚å†µï¼‰
   - Audience Analysisï¼ˆå—ä¼—åˆ†æï¼‰
   - Collaboration Opportunitiesï¼ˆåˆä½œæœºä¼šï¼‰
   - è‡ªåŠ¨åˆ†ç±»å’Œæ‰“æ ‡ç­¾

5. **å‘é‡åŒ–æœç´¢**
   - åŸºäºè¯­ä¹‰çš„ç›¸ä¼¼åº¦æœç´¢
   - Pinecone å‘é‡æ•°æ®åº“
   - æ™ºèƒ½æ’åºå’Œæ¨è

6. **æ•°æ®æŒä¹…åŒ–**
   - SQLite ä½œä¸ºå•ä¸€æ•°æ®æº
   - Pinecone ä½œä¸ºæœç´¢ç´¢å¼•
   - æ™ºèƒ½åŒæ­¥æœºåˆ¶

### ä½¿ç”¨åœºæ™¯

- **å“ç‰Œè¥é”€**: å¯»æ‰¾ç¬¦åˆå“ç‰Œè°ƒæ€§çš„å½±å“è€…
- **äº§å“æ¨å¹¿**: æ‰¾åˆ°ç›®æ ‡å—ä¼—åŒ¹é…çš„åˆ›ä½œè€…
- **å¸‚åœºè°ƒç ”**: äº†è§£è¡Œä¸šå†…çš„å…³é”®æ„è§é¢†è¢–
- **ç«å“åˆ†æ**: ç ”ç©¶ç«äº‰å¯¹æ‰‹åˆä½œçš„å½±å“è€…

---

## æ ¸å¿ƒæµç¨‹

### å®Œæ•´å·¥ä½œæµ

```
1. ç”¨æˆ·è¾“å…¥æè¿°
   "fitness influencers in Singapore"
   â†“
2. Intent Analysis (LLM)
   æå–ï¼šè¡Œä¸š=fitness, åœ°ç‚¹=Singapore, çº¦æŸ=[]
   â†“
3. Google Dork Generation (LLM)
   ç”Ÿæˆï¼š"site:instagram.com fitness Singapore"
   â†“
4. Google Search (Apify)
   è¿”å›ï¼š30-50 ä¸ª Instagram profile URLs
   â†“
5. Instagram Scraping (Apify)
   æŠ“å–æ¯ä¸ª profileï¼š
   - åŸºç¡€ä¿¡æ¯ï¼ˆfollowers, bio, etc.ï¼‰
   - æœ€è¿‘ 12 ä¸ªå¸–å­
   - äº’åŠ¨æ•°æ®ï¼ˆlikes, comments, viewsï¼‰
   â†“
6. LLM Analysis (å¹¶è¡Œå¤„ç†)
   å¯¹æ¯ä¸ª profileï¼š
   - Profile Summary
   - Audience Analysis
   - Collaboration Opportunities
   - Category & Tags
   â†“
7. Save to SQLite (å•ä¸€æ•°æ®æº)
   å­˜å‚¨å®Œæ•´æ•°æ®åˆ°æ•°æ®åº“
   â†“
8. Vectorize & Upsert to Pinecone
   - å°† profile_summary è½¬ä¸ºå‘é‡
   - å­˜å‚¨åˆ° Pineconeï¼ˆä»…ç”¨äºæœç´¢ï¼‰
   â†“
9. Vector Search
   åŸºäºç”¨æˆ·æè¿°æŸ¥æ‰¾ç›¸ä¼¼ profiles
   è¿”å›ï¼šhandles + scores
   â†“
10. Fetch from SQLite
    é€šè¿‡ handles è·å–å®Œæ•´æ•°æ®
    â†“
11. Return Results
    æŒ‰ç›¸å…³æ€§æ’åºè¿”å›ç»™å‰ç«¯
```

### æ•°æ®æµä¼˜åŒ–

#### æ ¸å¿ƒåŸåˆ™ï¼šSQLite ä¸ºä¸»ï¼ŒPinecone ä¸ºè¾…

```
SQLite (Single Source of Truth)
   â†“ å•å‘åŒæ­¥
Pinecone (Search Index Only)
   â†“ è¿”å› handle + score
SQLite (æŸ¥è¯¢å®Œæ•´æ•°æ®)
   â†“
è¿”å›ç»™å‰ç«¯
```

**å…³é”®ç‚¹**ï¼š
- âœ… SQLite æ˜¯å”¯ä¸€çš„æ•°æ®æº
- âœ… Pinecone åªç”¨äºå‘é‡æœç´¢
- âœ… æ‰€æœ‰æ•°æ®å†™å…¥å…ˆåˆ° SQLite
- âœ… æ‰€æœ‰æ•°æ®è¯»å–ä» SQLite
- âŒ æ°¸è¿œä¸è¦ä» Pinecone metadata åˆ›å»º/æ›´æ–°æ•°æ®

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

**åç«¯**:
- FastAPI 0.115.0 (API æœåŠ¡å™¨)
- SQLAlchemy 2.0.34 (ORM)
- SQLite (æ•°æ®åº“)
- Celery 5.4.0 (å¼‚æ­¥ä»»åŠ¡)
- Redis 5.0.8 (ä»»åŠ¡é˜Ÿåˆ—)

**å‰ç«¯**:
- Next.js 14 (React æ¡†æ¶)
- TypeScript
- Tailwind CSS

**å¤–éƒ¨æœåŠ¡**:
- **Apify**: æ•°æ®æŠ“å–
  - Google Search Actor
  - Instagram Profile Scraper
- **Pinecone**: å‘é‡æœç´¢
  - Inference API (å†…ç½® embedding)
- **Gemini/OpenAI**: LLM æœåŠ¡
  - æ„å›¾åˆ†æ
  - å†…å®¹ç”Ÿæˆ
  - åˆ†ç±»æ ‡ç­¾

**LangChain é›†æˆ** (å¯é€‰):
- ç»Ÿä¸€çš„ LLM chains
- Prompt æ¨¡æ¿åŒ–ç®¡ç†
- å¯é€šè¿‡é…ç½®å¼€å…³å¯ç”¨

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (Next.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Search    â”‚  â”‚   Results    â”‚  â”‚   Profile     â”‚ â”‚
â”‚  â”‚    Input     â”‚  â”‚    List      â”‚  â”‚   Detail      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Backend (FastAPI)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              API Routes Layer                     â”‚  â”‚
â”‚  â”‚  /requests  /results  /influencers               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Discovery Manager     â”‚  Pipeline   â”‚  Search    â”‚ â”‚
â”‚  â”‚  - Request management  â”‚  - Execute  â”‚  - Vector  â”‚ â”‚
â”‚  â”‚  - Result storage      â”‚  - Analyze  â”‚  - Rank    â”‚ â”‚
â”‚  â”‚  - Status tracking     â”‚  - Save     â”‚  - Filter  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                â”‚              â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    LLM Services         Apify Provider            â”‚ â”‚
â”‚  â”‚  - Intent parsing    - Google search              â”‚ â”‚
â”‚  â”‚  - Dork generation   - IG scraping                â”‚ â”‚
â”‚  â”‚  - Profile analysis  - Data extraction            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚   Apify      â”‚ â”‚  Pinecone â”‚ â”‚   Gemini    â”‚ â”‚ SQLite  â”‚
â”‚   Actors     â”‚ â”‚  Vectors  â”‚ â”‚   API       â”‚ â”‚   DB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¹¶å‘å¤„ç†

```
Pipeline Run
    â†“
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘ç°é˜¶æ®µï¼ˆä¸²è¡Œï¼‰                    â”‚
â”‚ 1. Google Search                    â”‚
â”‚ 2. Instagram Scraping               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†æé˜¶æ®µï¼ˆå¹¶è¡Œï¼‰                    â”‚
â”‚ Profile 1 â†’ LLM Analysis            â”‚
â”‚ Profile 2 â†’ LLM Analysis            â”‚
â”‚ Profile 3 â†’ LLM Analysis            â”‚
â”‚ ...                                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­˜å‚¨é˜¶æ®µï¼ˆæ‰¹é‡ï¼‰                    â”‚
â”‚ 1. Batch save to SQLite             â”‚
â”‚ 2. Batch upsert to Pinecone         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœç´¢é˜¶æ®µ                            â”‚
â”‚ 1. Vector search                    â”‚
â”‚ 2. Fetch from SQLite                â”‚
â”‚ 3. Rank & return                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æ¨¡å‹

### æ•°æ®åº“è¡¨ç»“æ„

#### 1. `influencers` - å½±å“è€…ä¸»è¡¨

```sql
CREATE TABLE influencers (
    id INTEGER PRIMARY KEY,
    handle TEXT UNIQUE NOT NULL,           -- Instagram handle (@username)
    name TEXT,
    bio TEXT,
    profile_summary TEXT,                  -- LLM ç”Ÿæˆçš„æ¦‚å†µ
    category TEXT,                         -- åˆ†ç±»
    tags TEXT,                             -- æ ‡ç­¾ï¼ˆJSON arrayï¼‰
    
    -- åŸºç¡€æŒ‡æ ‡
    followers FLOAT,
    avg_likes FLOAT,
    avg_comments FLOAT,
    avg_video_views FLOAT,
    
    -- å³°å€¼æŒ‡æ ‡
    highest_likes FLOAT,
    highest_comments FLOAT,
    highest_video_views FLOAT,
    
    -- å¸–å­åˆ†æ
    post_sharing_percentage FLOAT,         -- åˆ†äº«å¸–å­å æ¯”
    post_collaboration_percentage FLOAT,   -- åˆä½œå¸–å­å æ¯”
    
    -- LLM åˆ†æç»“æœ
    audience_analysis TEXT,                -- å—ä¼—åˆ†æ
    collaboration_opportunity TEXT,        -- åˆä½œæœºä¼š
    
    -- è”ç³»ä¿¡æ¯
    email TEXT,
    external_url TEXT,
    
    -- å…ƒæ•°æ®
    platform TEXT DEFAULT 'instagram',
    country TEXT,
    gender TEXT,
    profile_url TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_influencers_handle ON influencers(handle);
CREATE INDEX idx_influencers_category ON influencers(category);
CREATE INDEX idx_influencers_followers ON influencers(followers);
```

#### 2. `requests` - æœç´¢è¯·æ±‚è¡¨

```sql
CREATE TABLE requests (
    id INTEGER PRIMARY KEY,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    status TEXT NOT NULL,                  -- PARTIAL, PROCESSING, DONE, FAILED
    description TEXT NOT NULL,             -- ç”¨æˆ·è¾“å…¥æè¿°
    constraints TEXT,                      -- çº¦æŸæ¡ä»¶
    intent TEXT,                           -- LLM è§£æçš„æ„å›¾
    query_embedding TEXT                   -- æŸ¥è¯¢å‘é‡ï¼ˆç”¨äºæœç´¢ï¼‰
);

CREATE INDEX idx_requests_status ON requests(status);
CREATE INDEX idx_requests_created_at ON requests(created_at);
```

#### 3. `request_results` - æœç´¢ç»“æœå…³è”è¡¨

```sql
CREATE TABLE request_results (
    id INTEGER PRIMARY KEY,
    request_id INTEGER NOT NULL,
    influencer_id INTEGER NOT NULL,
    score FLOAT,                           -- æ¥è‡ª Pinecone çš„ç›¸ä¼¼åº¦åˆ†æ•°
    rank INTEGER,                          -- æ’å
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (request_id) REFERENCES requests(id) ON DELETE CASCADE,
    FOREIGN KEY (influencer_id) REFERENCES influencers(id) ON DELETE CASCADE
);

CREATE INDEX idx_request_results_request_id ON request_results(request_id);
CREATE INDEX idx_request_results_score ON request_results(score);
```

### çŠ¶æ€æšä¸¾

#### Request çŠ¶æ€

- `PARTIAL` - åˆ›å»ºä½†æœªå¼€å§‹å¤„ç†
- `PROCESSING` - æ­£åœ¨å¤„ç†ä¸­
- `DONE` - å®Œæˆ
- `FAILED` - å¤±è´¥

### Pinecone å‘é‡ç»“æ„

```python
# Pinecone ä¸­å­˜å‚¨çš„å‘é‡è®°å½•
{
    "id": "instagram_username",           # ä½¿ç”¨ handle ä½œä¸º ID
    "values": [0.1, 0.2, ...],           # å‘é‡ï¼ˆç”± Pinecone Inference ç”Ÿæˆï¼‰
    "metadata": {
        "handle": "username",
        "platform": "instagram",
        "followers": 50000,
        "category": "fitness"
    }
}
```

**é‡è¦**ï¼šmetadata ä»…ç”¨äºè¿‡æ»¤å’Œè¿”å›åŸºæœ¬ä¿¡æ¯ï¼Œä¸ç”¨äºåˆ›å»º/æ›´æ–°æ•°æ®åº“è®°å½•ã€‚

---

## æ•°æ®åŒæ­¥ç­–ç•¥

### æ ¸å¿ƒåŸåˆ™

**SQLite æ˜¯å”¯ä¸€çœŸç›¸æº (Single Source of Truth)**

1. âœ… æ‰€æœ‰æ•°æ®å…ˆå†™å…¥ SQLite
2. âœ… å†åŒæ­¥åˆ° Pineconeï¼ˆä»…ç”¨äºæœç´¢ï¼‰
3. âœ… æœç´¢æ—¶ä» Pinecone è·å– handles + scores
4. âœ… å†ä» SQLite æŸ¥è¯¢å®Œæ•´æ•°æ®
5. âŒ æ°¸è¿œä¸è¦ä» Pinecone åˆ›å»º/æ›´æ–° Influencer

### æ•°æ®æµ

#### å†™å…¥æµç¨‹

```python
def save_and_sync(candidate_data):
    # Step 1: ä¿å­˜åˆ° SQLiteï¼ˆä¸»æ•°æ®æºï¼‰
    influencer = Influencer(**candidate_data)
    db.add(influencer)
    db.commit()
    
    # Step 2: åŒæ­¥åˆ° Pineconeï¼ˆæœç´¢ç´¢å¼•ï¼‰
    vector_store.upsert_texts(
        texts=[influencer.profile_summary],
        ids=[f"instagram_{influencer.handle}"],
        metadatas=[{
            "handle": influencer.handle,
            "platform": "instagram",
            "followers": influencer.followers,
            "category": influencer.category
        }]
    )
    
    return influencer
```

#### æœç´¢æµç¨‹

```python
def search_and_fetch(query: str, top_k: int = 20):
    # Step 1: å‘é‡æœç´¢ï¼ˆPineconeï¼‰
    matches = vector_store.search_text(query, top_k=top_k)
    # matches = [
    #     {"id": "instagram_user1", "score": 0.95, "metadata": {...}},
    #     {"id": "instagram_user2", "score": 0.89, "metadata": {...}}
    # ]
    
    # Step 2: æå– handles
    handles = [m["metadata"]["handle"] for m in matches]
    
    # Step 3: ä» SQLite æŸ¥è¯¢å®Œæ•´æ•°æ®
    influencers = db.query(Influencer).filter(
        Influencer.handle.in_(handles)
    ).all()
    
    # Step 4: åˆå¹¶ score å¹¶æ’åº
    handle_to_influencer = {inf.handle: inf for inf in influencers}
    results = []
    for match in matches:
        handle = match["metadata"]["handle"]
        if handle in handle_to_influencer:
            influencer = handle_to_influencer[handle]
            results.append({
                "influencer": influencer,
                "score": match["score"]
            })
    
    return results
```

#### å­˜å‚¨ç»“æœæµç¨‹

```python
def store_results(request_id: int, matches: List[Dict]):
    """
    åªå­˜å‚¨å¼•ç”¨å…³ç³»ï¼Œä¸åˆ›å»ºæ–°çš„ Influencer
    """
    for rank, match in enumerate(matches, 1):
        handle = match["metadata"]["handle"]
        
        # ä» SQLite æŸ¥æ‰¾ Influencer
        influencer = db.query(Influencer).filter(
            Influencer.handle == handle
        ).first()
        
        if not influencer:
            # âŒ ä¸è¦åˆ›å»ºï¼åªè®°å½•è­¦å‘Š
            logger.warning(
                f"Influencer @{handle} found in Pinecone but not in SQLite. "
                "Data inconsistency detected. Skipping."
            )
            continue
        
        # âœ… åªå­˜å‚¨å¼•ç”¨
        result = RequestResult(
            request_id=request_id,
            influencer_id=influencer.id,  # æ¥è‡ª SQLite
            score=match.get("score"),      # æ¥è‡ª Pinecone
            rank=rank
        )
        db.add(result)
    
    db.commit()
```

### å†å²é—®é¢˜ä¸è§£å†³

#### é—®é¢˜ 1ï¼šæ•°æ®ä¸ä¸€è‡´

**åœºæ™¯ A**:
```
1. Pipeline å‘ç°æ–°åšä¸» â†’ å­˜å…¥ SQLite âœ…
2. Pipeline å‘é‡åŒ– â†’ å­˜å…¥ Pinecone âœ…
3. åæ¥æ‰‹åŠ¨æ›´æ–° SQLite ä¸­çš„æ•°æ®
   âŒ Pinecone æ²¡æœ‰æ›´æ–° â†’ ä¸ä¸€è‡´
```

**åœºæ™¯ B**:
```
1. Pinecone ä¸­æœ‰æ—§æ•°æ®
2. SQLite ä¸­æ˜¯ç©ºçš„æˆ–æ—§çš„
3. æœç´¢æ—¶ä» Pinecone è¿”å›
   âŒ SQLite ä¸­æ‰¾ä¸åˆ°æˆ–æ•°æ®ä¸å®Œæ•´
```

#### é—®é¢˜ 2ï¼šèŒè´£ä¸æ¸…æ™°

```
âŒ Pinecone æ—¢æ˜¯æœç´¢å¼•æ“ï¼Œåˆæ˜¯æ•°æ®æº
âŒ SQLite æ—¢æ˜¯æ•°æ®åº“ï¼Œåˆä¾èµ– Pinecone è¡¥å……
```

#### è§£å†³æ–¹æ¡ˆ

**1. ä¿®æ”¹ `_store_results` æ–¹æ³•**

ä¹‹å‰ï¼ˆé”™è¯¯ï¼‰ï¼š
```python
if not influencer:
    # ä» Pinecone metadata åˆ›å»º Influencer âŒ
    influencer = Influencer(
        profile_summary=meta.get("profile_summary"),
        ...
    )
```

ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰ï¼š
```python
if not influencer:
    # ä¸åˆ›å»ºï¼åªè®°å½•è­¦å‘Š âœ…
    logger.warning(
        f"Influencer @{handle} found in Pinecone but not in SQLite. "
        "Data inconsistency detected. Skipping."
    )
    continue

# åªå­˜å‚¨å¼•ç”¨ï¼ˆhandle -> score mappingï¼‰
result = RequestResult(
    request_id=request.id,
    influencer_id=influencer.id,  # æ¥è‡ª SQLite
    score=match.get("score"),      # æ¥è‡ª Pinecone
    rank=rank,
)
```

**2. Pipeline ç¡®ä¿å…ˆå†™ SQLite**

```python
def run(self, description: str, constraints: str):
    # 1ï¸âƒ£ å‘ç°å€™é€‰è€…
    candidates = self._discover(...)
    
    # 2ï¸âƒ£ å…ˆå­˜å…¥ SQLiteï¼ˆå•ä¸€çœŸç›¸æºï¼‰
    for candidate in candidates:
        influencer = self._save_to_database(db, candidate)
    
    # 3ï¸âƒ£ å†åŒæ­¥åˆ° Pinecone
    self._upsert_vectors(candidates)
    
    # 4ï¸âƒ£ æœç´¢åªè¿”å› handle + score
    matches = self.vector_store.search_text(query, top_k=20)
    
    # 5ï¸âƒ£ å­˜å‚¨ç»“æœå¼•ç”¨
    self._store_results(db, request, matches)
```

**3. æ•°æ®æ›´æ–°ç­–ç•¥**

å¦‚æœéœ€è¦æ›´æ–°æ•°æ®ï¼Œå¿…é¡»åŒæ—¶æ›´æ–°ï¼š
```python
# 1. æ›´æ–° SQLite
influencer.profile_summary = new_summary
db.commit()

# 2. æ›´æ–° Pinecone
vector_store.upsert_texts(
    texts=[new_summary],
    ids=[f"instagram_{influencer.handle}"],
    metadatas=[{...}]
)
```

### æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

æä¾›å·¥å…·è„šæœ¬æ£€æŸ¥åŒæ­¥çŠ¶æ€ï¼š

```bash
# æ£€æŸ¥ SQLite ä¸­æœ‰ä½† Pinecone æ²¡æœ‰çš„
python scripts/sync_sqlite_to_pinecone.py

# æ£€æŸ¥ Pinecone ä¸­æœ‰ä½† SQLite æ²¡æœ‰çš„
python scripts/sync_pinecone_to_sqlite.py

# å¯¹æ¯”å¹¶åŒæ­¥
python scripts/sync_all.py
```

---

## å‰ç«¯è®¾è®¡

### UI å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Top Bar: Logo, Navigation                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Search Section                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ æè¿°ä½ çš„éœ€æ±‚...                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ "fitness influencers in Singapore"               â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ çº¦æŸæ¡ä»¶ï¼ˆå¯é€‰ï¼‰...                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ "must have > 10k followers"                      â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  [Search]                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Status: Processing... (30% complete)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Results Grid (3 columns on desktop, 1 on mobile)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ [Avatar] â”‚  â”‚ [Avatar] â”‚  â”‚ [Avatar] â”‚                    â”‚
â”‚  â”‚ @user1   â”‚  â”‚ @user2   â”‚  â”‚ @user3   â”‚                    â”‚
â”‚  â”‚ 50k fol. â”‚  â”‚ 120k fol.â”‚  â”‚ 30k fol. â”‚                    â”‚
â”‚  â”‚ Fitness  â”‚  â”‚ Lifestyleâ”‚  â”‚ Health   â”‚                    â”‚
â”‚  â”‚ 95% matchâ”‚  â”‚ 89% matchâ”‚  â”‚ 87% matchâ”‚                    â”‚
â”‚  â”‚ [View]   â”‚  â”‚ [View]   â”‚  â”‚ [View]   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Profile Detail Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @username                                        [âœ•]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  Name: John Doe                                    â”‚
â”‚  â”‚        â”‚  Followers: 50,000                                 â”‚
â”‚  â”‚ Avatar â”‚  Avg Likes: 2,500                                  â”‚
â”‚  â”‚        â”‚  Category: Fitness                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  ğŸ“§ email@example.com                              â”‚
â”‚              ğŸ”— website.com                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Profile Summary                                            â”‚
â”‚  A fitness coach based in Singapore...                         â”‚
â”‚                                                                  â”‚
â”‚  ğŸ‘¥ Audience Analysis                                          â”‚
â”‚  Primary audience: 25-35 year old professionals...            â”‚
â”‚                                                                  â”‚
â”‚  ğŸ¤ Collaboration Opportunities                                â”‚
â”‚  - Product reviews                                              â”‚
â”‚  - Sponsored posts                                              â”‚
â”‚  - Long-term ambassador                                         â”‚
â”‚                                                                  â”‚
â”‚  [Visit Instagram] [Save for Later]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å“åº”å¼è®¾è®¡

- **æ¡Œé¢**: 3åˆ—ç½‘æ ¼ï¼Œè¯¦ç»†å±•ç¤º
- **å¹³æ¿**: 2åˆ—ç½‘æ ¼
- **æ‰‹æœº**: å•åˆ—åˆ—è¡¨ï¼Œå¡ç‰‡å¼å±•ç¤º

---

## åç«¯æœåŠ¡

### 1. Discovery Manager (å‘ç°ç®¡ç†å™¨)

**èŒè´£**: åè°ƒæ•´ä¸ªå‘ç°æµç¨‹

**æ ¸å¿ƒæ–¹æ³•**:

```python
class DiscoveryManager:
    def create_request(
        self, 
        description: str, 
        constraints: str = None
    ) -> Request:
        """
        åˆ›å»ºæ–°çš„æœç´¢è¯·æ±‚
        
        æµç¨‹:
        1. åˆ›å»º Request è®°å½•ï¼ˆstatus=PARTIALï¼‰
        2. è§¦å‘å¼‚æ­¥ä»»åŠ¡
        3. è¿”å› Request ID
        """
    
    def get_request(self, request_id: int) -> Request:
        """
        è·å–è¯·æ±‚çŠ¶æ€
        
        è¿”å›:
        - status: PARTIAL/PROCESSING/DONE/FAILED
        - created_at
        - intentï¼ˆå¦‚æœå·²è§£æï¼‰
        """
    
    def get_results(
        self, 
        request_id: int,
        limit: int = 20,
        offset: int = 0
    ) -> List[Dict]:
        """
        è·å–æœç´¢ç»“æœ
        
        æµç¨‹:
        1. æŸ¥è¯¢ request_results è¡¨
        2. JOIN influencers è¡¨
        3. æŒ‰ score é™åºæ’åº
        4. åˆ†é¡µè¿”å›
        
        è¿”å›:
        [{
            "influencer": {...},  # å®Œæ•´æ•°æ®
            "score": 0.95,        # ç›¸ä¼¼åº¦
            "rank": 1
        }]
        """
```

### 2. Discovery Pipeline (å‘ç°æµç¨‹)

**èŒè´£**: æ‰§è¡Œå‘ç°å’Œåˆ†ææµç¨‹

**æ ¸å¿ƒæ–¹æ³•**:

```python
class DiscoveryPipeline:
    def run(
        self, 
        request_id: int,
        description: str,
        constraints: str = None
    ):
        """
        å®Œæ•´çš„å‘ç°æµç¨‹
        
        æ­¥éª¤:
        1. Intent Analysis
        2. Google Dork Generation
        3. Google Search
        4. Instagram Scraping
        5. LLM Analysis (å¹¶è¡Œ)
        6. Save to SQLite
        7. Upsert to Pinecone
        8. Vector Search
        9. Store Results
        """
    
    def _discover(self, intent: Dict) -> List[Dict]:
        """
        å‘ç°é˜¶æ®µ
        
        æµç¨‹:
        1. ç”Ÿæˆ Google Dork
        2. æ‰§è¡Œ Google æœç´¢
        3. æŠ“å– Instagram profiles
        
        è¿”å›: å€™é€‰äººåˆ—è¡¨
        """
    
    def _analyze(self, candidates: List[Dict]) -> List[Dict]:
        """
        åˆ†æé˜¶æ®µ
        
        å¹¶è¡Œå¤„ç†æ¯ä¸ªå€™é€‰äºº:
        1. Profile Summary
        2. Audience Analysis
        3. Collaboration Opportunities
        4. Category & Tags
        
        è¿”å›: å¸¦åˆ†æç»“æœçš„å€™é€‰äººåˆ—è¡¨
        """
    
    def _save_to_database(
        self, 
        db: Session, 
        candidate: Dict
    ) -> Influencer:
        """
        ä¿å­˜åˆ° SQLite
        
        å¤„ç†:
        - å»é‡ï¼ˆåŸºäº handleï¼‰
        - å¦‚æœå­˜åœ¨åˆ™æ›´æ–°
        - å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
        """
    
    def _upsert_vectors(self, candidates: List[Dict]):
        """
        åŒæ­¥åˆ° Pinecone
        
        æ‰¹é‡ä¸Šä¼ :
        - texts: profile_summary
        - ids: instagram_handle
        - metadatas: åŸºæœ¬ä¿¡æ¯
        """
```

### 3. Search Service (æœç´¢æœåŠ¡)

**èŒè´£**: å‘é‡æœç´¢å’Œæ’åº

**æ ¸å¿ƒæ–¹æ³•**:

```python
class SearchService:
    def search(
        self,
        query: str,
        top_k: int = 20,
        filters: Dict = None
    ) -> List[Dict]:
        """
        è¯­ä¹‰æœç´¢
        
        æµç¨‹:
        1. å‘é‡æœç´¢ï¼ˆPineconeï¼‰
        2. åº”ç”¨è¿‡æ»¤å™¨ï¼ˆcategory, followers ç­‰ï¼‰
        3. ä» SQLite è·å–å®Œæ•´æ•°æ®
        4. åˆå¹¶ score
        5. æ’åºè¿”å›
        
        è¿”å›:
        [{
            "influencer": Influencer object,
            "score": 0.95
        }]
        """
```

### 4. LLM Services (LLM æœåŠ¡)

**èŒè´£**: å„ç§ AI åˆ†æä»»åŠ¡

```python
class IntentParser:
    def parse(self, description: str, constraints: str) -> Dict:
        """
        è§£æç”¨æˆ·æ„å›¾
        
        è¾“å…¥: "fitness influencers in Singapore"
        è¾“å‡º: {
            "industry": "fitness",
            "location": "Singapore",
            "constraints": []
        }
        """

class GoogleDorkGenerator:
    def generate(self, intent: Dict) -> str:
        """
        ç”Ÿæˆ Google Dork
        
        è¾“å…¥: {"industry": "fitness", "location": "Singapore"}
        è¾“å‡º: "site:instagram.com fitness Singapore"
        """

class ProfileSummaryGenerator:
    def generate(self, profile_data: Dict) -> str:
        """
        ç”Ÿæˆ Profile Summary
        
        è¾“å…¥: IG profile + posts æ•°æ®
        è¾“å‡º: ç®€æ´çš„æ¦‚å†µæ–‡æœ¬ï¼ˆ2-3 å¥è¯ï¼‰
        """

class AudienceAnalyzer:
    def analyze(self, profile_data: Dict, summary: str) -> str:
        """
        åˆ†æå—ä¼—
        
        è¾“å…¥: profile æ•°æ® + summary
        è¾“å‡º: å—ä¼—åˆ†æï¼ˆå¹´é¾„ã€æ€§åˆ«ã€å…´è¶£ç­‰ï¼‰
        """

class CollaborationAnalyzer:
    def analyze(self, profile_data: Dict, summary: str) -> str:
        """
        åˆ†æåˆä½œæœºä¼š
        
        è¾“å…¥: profile æ•°æ® + summary
        è¾“å‡º: æ¨èçš„åˆä½œæ–¹å¼
        """
```

### 5. Apify Provider (æ•°æ®æŠ“å–)

**èŒè´£**: å°è£… Apify API

```python
class ApifyProvider:
    def search_google(
        self,
        query: str,
        max_results: int = 50
    ) -> List[str]:
        """
        Google æœç´¢
        
        ä½¿ç”¨ Apify Google Search Actor
        è¿”å›: Instagram profile URLs åˆ—è¡¨
        """
    
    def scrape_instagram_profile(
        self,
        username: str
    ) -> Dict:
        """
        æŠ“å– Instagram profile
        
        ä½¿ç”¨ Apify Instagram Profile Scraper
        è¿”å›: {
            "handle": "username",
            "followers": 50000,
            "bio": "...",
            "posts": [...]  # æœ€è¿‘ 12 ä¸ªå¸–å­
        }
        """
```

---

## API å‚è€ƒ

### è¯·æ±‚ç®¡ç†

#### POST `/api/v1/requests`
åˆ›å»ºæ–°çš„æœç´¢è¯·æ±‚

**Request**:
```json
{
  "description": "fitness influencers in Singapore",
  "constraints": "must have > 10k followers"
}
```

**Response**:
```json
{
  "id": 1,
  "status": "PARTIAL",
  "created_at": "2026-01-21T10:00:00"
}
```

#### GET `/api/v1/requests/{id}`
è·å–è¯·æ±‚çŠ¶æ€

**Response**:
```json
{
  "id": 1,
  "status": "PROCESSING",  // PARTIAL, PROCESSING, DONE, FAILED
  "description": "fitness influencers in Singapore",
  "intent": {
    "industry": "fitness",
    "location": "Singapore"
  },
  "created_at": "2026-01-21T10:00:00"
}
```

#### GET `/api/v1/requests/{id}/results`
è·å–æœç´¢ç»“æœ

**Query Parameters**:
- `limit`: é»˜è®¤ 20
- `offset`: é»˜è®¤ 0

**Response**:
```json
{
  "request_id": 1,
  "total_results": 50,
  "results": [
    {
      "influencer": {
        "id": 1,
        "handle": "fitness_sg",
        "name": "John Doe",
        "followers": 50000,
        "profile_summary": "...",
        "audience_analysis": "...",
        "collaboration_opportunity": "..."
      },
      "score": 0.95,
      "rank": 1
    }
  ]
}
```

### å½±å“è€…ç®¡ç†

#### GET `/api/v1/influencers`
åˆ—å‡ºæ‰€æœ‰å½±å“è€…

**Query Parameters**:
- `category`: è¿‡æ»¤åˆ†ç±»
- `min_followers`: æœ€å°ç²‰ä¸æ•°
- `limit`: é»˜è®¤ 50
- `offset`: é»˜è®¤ 0

#### GET `/api/v1/influencers/{id}`
è·å–å•ä¸ªå½±å“è€…è¯¦æƒ…

#### POST `/api/v1/influencers/{id}/update`
æ‰‹åŠ¨æ›´æ–°å½±å“è€…æ•°æ®

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

`backend/.env`:

```env
# ==== LLM é…ç½® ====
LLM_PROVIDER=gemini                    # gemini æˆ– openai
GEMINI_API_KEY=your_gemini_key
GEMINI_MODEL=gemini-2.0-flash-exp

# ==== Pinecone é…ç½® ====
PINECONE_API_KEY=your_pinecone_key
PINECONE_INDEX=moreach
PINECONE_HOST=your-index-host.pinecone.io

# ==== Apify é…ç½® ====
APIFY_TOKEN=your_apify_token

# Apify Actors (å¯é€‰ï¼Œæœ‰é»˜è®¤å€¼)
APIFY_GOOGLE_SEARCH_ACTOR=apify~google-search-scraper
APIFY_INSTAGRAM_SCRAPER_ACTOR=apify~instagram-profile-scraper

# ==== æ•°æ®åº“ ====
DATABASE_URL=sqlite:///./app.db

# ==== Redis (Celery) ====
REDIS_URL=redis://localhost:6379/0

# ==== LangChain (å¯é€‰) ====
USE_LANGCHAIN_CHAINS=true              # å¯ç”¨ LangChain
USE_LANGCHAIN_EMBEDDINGS=false         # ä¿æŒ false
USE_LANGCHAIN_VECTORSTORE=false        # ä¿æŒ false
```

### Pinecone é…ç½®

**Index è®¾ç½®**:
- Dimensions: æ ¹æ® embedding modelï¼ˆé€šå¸¸ 1024 æˆ– 1536ï¼‰
- Metric: cosine
- Pod Type: p1.x1 æˆ–æ›´é«˜

**Inference API** (æ¨è):
```python
# ä½¿ç”¨ Pinecone å†…ç½® embedding
vector_store.upsert_texts(
    texts=["text content"],
    inference=True  # è‡ªåŠ¨ embedding
)
```

---

## ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

#### 1. å¯åŠ¨æœåŠ¡

```bash
# Terminal 1: API æœåŠ¡å™¨
cd backend
python -m app.main

# Terminal 2: Celery Worker
celery -A app.workers.celery_app worker --loglevel=info

# Terminal 3: Frontend
cd frontend
npm run dev
```

#### 2. åˆ›å»ºæœç´¢è¯·æ±‚

**æ–¹å¼ 1: é€šè¿‡å‰ç«¯**
1. è®¿é—® http://localhost:3000/try
2. è¾“å…¥æè¿°ï¼š"fitness influencers in Singapore"
3. å¯é€‰ï¼šæ·»åŠ çº¦æŸ
4. ç‚¹å‡» "Search"
5. ç­‰å¾…ç»“æœï¼ˆ5-10åˆ†é’Ÿï¼‰

**æ–¹å¼ 2: é€šè¿‡ API**
```bash
curl -X POST http://localhost:8000/api/v1/requests \
  -H "Content-Type: application/json" \
  -d '{
    "description": "fitness influencers in Singapore",
    "constraints": "must have > 10k followers"
  }'
```

#### 3. æŸ¥çœ‹ç»“æœ

```bash
# æ£€æŸ¥çŠ¶æ€
curl http://localhost:8000/api/v1/requests/1

# è·å–ç»“æœ
curl http://localhost:8000/api/v1/requests/1/results
```

### å·¥ä½œæµç¤ºä¾‹

#### åœºæ™¯ï¼šå¯»æ‰¾å¥èº«å½±å“è€…

```python
# 1. åˆ›å»ºè¯·æ±‚
response = requests.post(
    "http://localhost:8000/api/v1/requests",
    json={
        "description": "fitness influencers in Singapore with focus on yoga",
        "constraints": "female, 20k-100k followers, high engagement"
    }
)
request_id = response.json()["id"]

# 2. è½®è¯¢çŠ¶æ€
import time
while True:
    status_response = requests.get(
        f"http://localhost:8000/api/v1/requests/{request_id}"
    )
    status = status_response.json()["status"]
    
    if status == "DONE":
        break
    elif status == "FAILED":
        print("Search failed!")
        exit(1)
    
    print(f"Status: {status}, waiting...")
    time.sleep(30)

# 3. è·å–ç»“æœ
results_response = requests.get(
    f"http://localhost:8000/api/v1/requests/{request_id}/results"
)
results = results_response.json()["results"]

# 4. å¤„ç†ç»“æœ
for result in results[:5]:  # Top 5
    influencer = result["influencer"]
    score = result["score"]
    
    print(f"@{influencer['handle']} - {score*100:.1f}% match")
    print(f"Followers: {influencer['followers']:,}")
    print(f"Summary: {influencer['profile_summary']}")
    print(f"Email: {influencer.get('email', 'N/A')}")
    print("---")
```

---

## æœ€ä½³å®è·µ

### æœç´¢æè¿°ä¼˜åŒ–

**å¥½çš„æè¿°**:
```
âœ… "fitness influencers in Singapore focusing on yoga and wellness"
âœ… "tech reviewers who cover smartphones and gadgets, based in US"
âœ… "fashion bloggers in Europe with minimalist aesthetic"
```

**ä¸å¥½çš„æè¿°**:
```
âŒ "influencers"ï¼ˆå¤ªæ³›ï¼‰
âŒ "best fitness people"ï¼ˆå¤ªä¸»è§‚ï¼‰
âŒ "æ‰¾ä¸€äº›åšä¸»"ï¼ˆå¤ªæ¨¡ç³Šï¼‰
```

### çº¦æŸæ¡ä»¶å»ºè®®

**æœ‰æ•ˆçº¦æŸ**:
- ç²‰ä¸æ•°èŒƒå›´ï¼š"10k-50k followers"
- äº’åŠ¨ç‡ï¼š"high engagement rate"
- æ€§åˆ«/å¹´é¾„ï¼š"female, 25-35 years old"
- åœ°ç†ä½ç½®ï¼š"based in Singapore"
- å†…å®¹ç±»å‹ï¼š"focus on product reviews"

### æ€§èƒ½ä¼˜åŒ–

**1. æ‰¹é‡å¤„ç†**
- ä¸€æ¬¡æœç´¢å¯ä»¥å‘ç° 30-50 ä¸ª profiles
- é¿å…é¢‘ç¹çš„å°è¯·æ±‚

**2. ç¼“å­˜åˆ©ç”¨**
- å·²æŠ“å–çš„ profile ä¼šä¿å­˜åœ¨æ•°æ®åº“
- ç›¸ä¼¼æœç´¢ä¼šå¤ç”¨å·²æœ‰æ•°æ®

**3. å¹¶è¡Œåˆ†æ**
- LLM åˆ†æè‡ªåŠ¨å¹¶è¡Œå¤„ç†
- åŠ å¿«æ•´ä½“æµç¨‹

### æˆæœ¬æ§åˆ¶

**Apify ä½¿ç”¨**:
- Google Search: ~$0.001/æœç´¢
- Instagram Scraping: ~$0.01/profile
- æ€»æˆæœ¬: ~$0.50-1.00/æœç´¢ï¼ˆ30-50 profilesï¼‰

**LLM ä½¿ç”¨**:
- Intent Analysis: 1 æ¬¡
- Dork Generation: 1 æ¬¡
- Profile Analysis: 3 æ¬¡/profile Ã— 50 profiles = 150 æ¬¡
- ä½¿ç”¨ Gemini Flash å¯å¤§å¹…é™ä½æˆæœ¬

**Pinecone ä½¿ç”¨**:
- ä½¿ç”¨ Inference API èŠ‚çœ embedding æˆæœ¬
- æŒ‰éœ€ç´¢å¼•ï¼Œä¸å­˜å‚¨å†—ä½™æ•°æ®

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæœç´¢ä¸€ç›´æ˜¯ PROCESSING çŠ¶æ€

**å¯èƒ½åŸå› **:
1. Celery worker æœªè¿è¡Œ
2. Apify é…é¢ä¸è¶³
3. LLM API é™æµ
4. ç½‘ç»œé—®é¢˜

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥ Celery worker æ—¥å¿—
tail -f celery_worker.log

# 2. æ£€æŸ¥ Apify é…é¢
# è®¿é—® https://console.apify.com/account/usage

# 3. æµ‹è¯• LLM API
python -c "from app.services.llm.client import LLMClient; \
            print(LLMClient().analyze('test'))"

# 4. æ‰‹åŠ¨è§¦å‘ä»»åŠ¡
python -c "from app.workers.tasks import run_discovery_pipeline; \
            run_discovery_pipeline.apply(args=(1,))"
```

### é—®é¢˜ï¼šæœç´¢ç»“æœä¸ºç©º

**å¯èƒ½åŸå› **:
1. Google æœç´¢æœªæ‰¾åˆ°ç›¸å…³ profiles
2. Instagram æŠ“å–å¤±è´¥
3. Pinecone æœç´¢æœªåŒ¹é…

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥ Request çš„ intent
curl http://localhost:8000/api/v1/requests/1 | jq '.intent'

# 2. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰ influencers
sqlite3 app.db "SELECT COUNT(*) FROM influencers;"

# 3. æ£€æŸ¥ Pinecone ä¸­çš„å‘é‡æ•°é‡
python scripts/debug_pinecone_search.py

# 4. æ‰‹åŠ¨æµ‹è¯•æœç´¢
curl http://localhost:8000/api/v1/influencers?limit=10
```

### é—®é¢˜ï¼šæ•°æ®ä¸ä¸€è‡´ï¼ˆSQLite vs Pineconeï¼‰

**æ’æŸ¥**:
```bash
# æ£€æŸ¥åŒæ­¥çŠ¶æ€
python scripts/sync_check.py

# ä» SQLite åŒæ­¥åˆ° Pinecone
python scripts/sync_sqlite_to_pinecone.py

# ä» Pinecone åŒæ­¥åˆ° SQLiteï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
python scripts/sync_pinecone_to_sqlite.py
```

### é—®é¢˜ï¼šLangChain å¯ç”¨åå‡ºé”™

**æ’æŸ¥**:
```bash
# 1. ç¡®è®¤ä¾èµ–å·²å®‰è£…
pip install -r requirements.txt

# 2. æ£€æŸ¥é…ç½®
grep USE_LANGCHAIN backend/.env

# 3. æµ‹è¯• LangChain
python -m app.services.langchain_poc.test_llm_chain

# 4. å¦‚æœå¤±è´¥ï¼Œå›æ»š
# ç¼–è¾‘ .env: USE_LANGCHAIN_CHAINS=false
```

---

## æŠ€æœ¯å‚è€ƒ

### ä»£ç ç»“æ„

```
backend/app/
â”œâ”€â”€ api/v1/routes.py              # API ç«¯ç‚¹
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ tables.py                 # æ•°æ®åº“æ¨¡å‹
â”‚   â””â”€â”€ schemas.py                # Pydantic schemas
â”œâ”€â”€ providers/
â”‚   â”œâ”€â”€ apify/client.py          # Apify å°è£…
â”‚   â”œâ”€â”€ google/search.py         # Google æœç´¢
â”‚   â””â”€â”€ instagram/scrape.py      # IG æŠ“å–
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ discovery/
â”‚   â”‚   â”œâ”€â”€ manager.py           # ä¸»åè°ƒå™¨
â”‚   â”‚   â”œâ”€â”€ pipeline.py          # å‘ç°æµç¨‹
â”‚   â”‚   â””â”€â”€ search.py            # å‘é‡æœç´¢
â”‚   â”œâ”€â”€ llm/                     # LLM æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ intent.py
â”‚   â”‚   â”œâ”€â”€ dork.py
â”‚   â”‚   â”œâ”€â”€ profile_summary.py
â”‚   â”‚   â”œâ”€â”€ audience_analysis.py
â”‚   â”‚   â””â”€â”€ collaboration_analysis.py
â”‚   â”œâ”€â”€ langchain/               # LangChain é›†æˆï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â””â”€â”€ chains/
â”‚   â””â”€â”€ vector/
â”‚       â””â”€â”€ pinecone.py          # Pinecone å®¢æˆ·ç«¯
â””â”€â”€ workers/
    â”œâ”€â”€ celery_app.py            # Celery é…ç½®
    â””â”€â”€ tasks.py                 # å¼‚æ­¥ä»»åŠ¡

frontend/app/
â”œâ”€â”€ try/page.tsx                 # æœç´¢é¡µé¢
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts                   # API è°ƒç”¨
â”‚   â””â”€â”€ types.ts                 # TypeScript ç±»å‹
â””â”€â”€ components/                  # UI ç»„ä»¶
```

### å…³é”®æ–‡ä»¶

**åç«¯**:
- `backend/app/services/discovery/manager.py` - ä¸»è¦ä¸šåŠ¡é€»è¾‘
- `backend/app/services/discovery/pipeline.py` - å‘ç°æµç¨‹å®ç°
- `backend/app/api/v1/routes.py` - API ç«¯ç‚¹å®šä¹‰
- `backend/app/providers/apify/client.py` - Apify é›†æˆ

**å‰ç«¯**:
- `frontend/app/try/page.tsx` - æœç´¢ç•Œé¢

---

## ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ¦‚è§ˆ
- [ARCHITECTURE.md](ARCHITECTURE.md) - å®Œæ•´æ¶æ„æ–‡æ¡£
- [REDDIT_DESIGN.md](REDDIT_DESIGN.md) - Reddit åŠŸèƒ½è®¾è®¡
- [LANGCHAIN_MIGRATION_GUIDE.md](LANGCHAIN_MIGRATION_GUIDE.md) - LangChain ä½¿ç”¨æŒ‡å—

---

## ç»“è¯­

Instagram Influencer Discovery æ˜¯ä¸€ä¸ªæˆç†Ÿçš„ã€ç”Ÿäº§å°±ç»ªçš„ç³»ç»Ÿï¼Œé‡‡ç”¨æ¸…æ™°çš„æ•°æ®æ¶æ„å’Œæ™ºèƒ½çš„ AI åˆ†æã€‚

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **AI é©±åŠ¨** - å…¨æµç¨‹æ™ºèƒ½åŒ–  
âœ… **æ•°æ®ä¸€è‡´æ€§** - SQLite å•ä¸€æ•°æ®æº  
âœ… **é«˜æ•ˆæœç´¢** - å‘é‡åŒ–è¯­ä¹‰æœç´¢  
âœ… **å¯æ‰©å±•** - æ¸…æ™°çš„ä»£ç ç»“æ„  
âœ… **æˆæœ¬ä¼˜åŒ–** - æ‰¹é‡å¤„ç†å’Œç¼“å­˜  

### å¼€å§‹ä½¿ç”¨

1. é…ç½® Apifyã€Pinecone å’Œ Gemini API
2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
3. åˆ›å»ºç¬¬ä¸€ä¸ªæœç´¢è¯·æ±‚
4. æŸ¥çœ‹å’Œåˆ†æç»“æœ

ç¥ä½ æ‰¾åˆ°å®Œç¾çš„å½±å“è€…åˆä½œä¼™ä¼´ï¼ğŸš€

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2026-01-21  
**ç»´æŠ¤è€…**: AI Assistant

